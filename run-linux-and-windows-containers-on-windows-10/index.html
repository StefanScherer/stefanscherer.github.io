<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Run Linux and Windows Containers on Windows 10</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=d314bbb4c7" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="https://stefanscherer.github.io/run-linux-and-windows-containers-on-windows-10/" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Stefan Scherer&#x27;s Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Run Linux and Windows Containers on Windows 10" />
    <meta property="og:description" content="At DockerCon 2016 in Seattle Docker announced the public beta of Docker for Windows. With this you can work with Docker running Linux containers in a very easy way on Windows 10 Pro with Hyper-V installed. In the meantime there is a stable version and a beta channel to retrieve" />
    <meta property="og:url" content="https://stefanscherer.github.io/run-linux-and-windows-containers-on-windows-10/" />
    <meta property="article:published_time" content="2016-09-24T12:55:29.249Z" />
    <meta property="article:modified_time" content="2016-09-24T13:02:30.650Z" />
    <meta property="article:tag" content="Docker" />
    <meta property="article:tag" content="Windows" />
    <meta property="article:tag" content="Linux" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Run Linux and Windows Containers on Windows 10" />
    <meta name="twitter:description" content="At DockerCon 2016 in Seattle Docker announced the public beta of Docker for Windows. With this you can work with Docker running Linux containers in a very easy way on Windows 10 Pro with Hyper-V installed. In the meantime there is a stable version and a beta channel to retrieve" />
    <meta name="twitter:url" content="https://stefanscherer.github.io/run-linux-and-windows-containers-on-windows-10/" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Stefan Scherer's Blog",
    "author": {
        "@type": "Person",
        "name": "Stefan Scherer",
        "image": "https://stefanscherer.github.io/content/images/2016/03/Stefan-256-1.jpg",
        "url": "https://stefanscherer.github.io/author/stefan-scherer/",
        "sameAs": "https://stefanscherer.github.io"
    },
    "headline": "Run Linux and Windows Containers on Windows 10",
    "url": "https://stefanscherer.github.io/run-linux-and-windows-containers-on-windows-10/",
    "datePublished": "2016-09-24T12:55:29.249Z",
    "dateModified": "2016-09-24T13:02:30.650Z",
    "keywords": "Docker, Windows, Linux",
    "description": "At DockerCon 2016 in Seattle Docker announced the public beta of Docker for Windows. With this you can work with Docker running Linux containers in a very easy way on Windows 10 Pro with Hyper-V installed. In the meantime there is a stable version and a beta channel to retrieve"
}
    </script>

    <meta name="generator" content="Ghost 0.7" />
    <link rel="alternate" type="application/rss+xml" title="Stefan Scherer&#x27;s Blog" href="https://stefanscherer.github.io/rss/" />
</head>
<body class="post-template tag-docker tag-windows tag-linux nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home" role="presentation"><a href="https://stefanscherer.github.io/">Home</a></li>
            <li class="nav-talks" role="presentation"><a href="https://stefanscherer.github.io/talks/">Talks</a></li>
            <li class="nav-twitter" role="presentation"><a href="https://twitter.com/stefscherer">Twitter</a></li>
            <li class="nav-github" role="presentation"><a href="https://github.com/StefanScherer">GitHub</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="https://stefanscherer.github.io/rss/">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-docker tag-windows tag-linux">

        <header class="post-header">
            <h1 class="post-title">Run Linux and Windows Containers on Windows 10</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2016-09-24">24 September 2016</time>  on <a href="../tag/docker/">Docker</a>, <a href="../tag/windows/">Windows</a>, <a href="../tag/linux/">Linux</a>
            </section>
        </header>

        <section class="post-content">
            <p>At DockerCon 2016 in Seattle Docker announced the public beta of <strong>Docker for Windows</strong>. With this you can work with Docker running <strong>Linux containers</strong> in a very easy way on Windows 10 Pro with Hyper-V installed. In the meantime there is a <a href="https://docs.docker.com/docker-for-windows/">stable version and a beta channel</a> to retrieve newer versions.</p>

<p>And Microsoft has added the <strong>Containers feature</strong> in the Windows 10 Anniversary Update. With some <a href="https://msdn.microsoft.com/en-us/virtualization/windowscontainers/quick_start/quick_start_windows_10">installation steps</a> you are able to run <strong>Windows Hyper-V Containers</strong> on your Windows 10 machine.</p>

<p>But there is a little bit of confusion which sort of containers can be started with each of the two installations. And you can't run both Docker Engines side-by-side without some adjustments.</p>

<p>This is because each of the installations use the same default named pipe <code>//./pipe/docker_engine</code> causing one of the engines to fail to start.</p>

<h2 id="beta26torulethemall">Beta 26 to rule them all</h2>

<p>Beginning with the Docker for Windows Beta 26 there is a very easy approach to solve this confusion. You only have to install Docker for Windows with the MSI installer. There is a new menu item in the Docker tray icon to switch between Linux and Windows containers.</p>

<p><img src="../content/images/2016/09/docker-for-windows-switch.gif" alt="switching" /></p>

<p>As you can see in the video you don't have to change environment variables or use the <code>-H</code> option of the Docker client to talk to the other Docker engine.</p>

<p>So if you download <a href="https://docs.docker.com/docker-for-windows/">Docker for Windows beta</a> or switch to the beta channel in your installation you can try this out yourself.</p>

<p>The installer will activate the <strong>Containers</strong> feature if you haven't done that yet. A reboot is required for this to add this feature.</p>

<p>From now on you can easily switch with the menu item in the tray icon.</p>

<p>There also is a command line tool to switch the engine. In a PowerShell windows you can type</p>

<pre><code>&amp; 'C:\Program Files\Docker\Docker\DockerCli.exe' -SwitchDaemon
</code></pre>

<p>and it switches from Linux to Windows or vice versa. Take care and type the option as shown here as the option is case sensitive.</p>

<h2 id="proxyfortherescue">Proxy for the rescue</h2>

<p>But how does the switching work without the need to use another named pipe or socket from the Docker client?</p>

<p>The answer is that there is running a Proxy process <code>com.docker.proxy.exe</code> which listens on the default named pipe <code>//./pipe/docker_engine</code>.</p>

<p>If you switch from Linux to Windows the Windows Docker engine <code>dockerd.exe</code> will be started for you which is listening on another named pipe <code>//./pipe/docker_engine_windows</code> and a new started Proxy process redirects to this.</p>

<h3 id="underthehood">Under the hood</h3>

<p>I have installed the <a href="https://technet.microsoft.com/sysinternals/bb896645">Sysinternals Process Monitor</a> tool to learn what happens while switching from Linux to Windows containers. With the Process Tree function you can see a timeline with green bars when each process has started or exited.</p>

<p>The following screenshot shows the processes before and after the switch. I have switched about in the middle of the green bar.</p>

<p><img src="../content/images/2016/09/switch-to-windows-dockerd.png" alt="" /></p>

<p>The current <code>com.docker.proxy.exe</code> (above <code>dockerd.exe</code> in the list) that talked to the MobyLinuxVM exits as the dark green bar highlights that.</p>

<p>The <code>dockerd.exe</code> Windows Docker engine is started, as well as a new <code>com.docker.proxy.exe</code> (below <code>dockerd.exe</code>) which talks to the Windows Docker engine.</p>

<p>So just after the switch you still can use the <code>docker.exe</code> Client or your Docker integration in your favorite editor or IDE without any environment changes.</p>

<h2 id="runningbothcontainerworldsinparallel">Running both container worlds in parallel</h2>

<p>The proxy process just switches the connection to the Docker engine. After such a switch both the Linux and Windows Docker engine are running.</p>

<h3 id="runalinuxwebserver">Run a Linux web server</h3>

<p>To try this out we first switch back to the Linux containers. Now we run the default nginx web server on port 80</p>

<pre><code>docker run -p 80:80 -d nginx  
</code></pre>

<p>then switch to the Windows containers with</p>

<pre><code>'C:\Program Files\Docker\Docker\DockerCli.exe' -SwitchDaemon  
</code></pre>

<p><img src="../content/images/2016/09/docker-run-nginx.png" alt="docker-run-nginx" /></p>

<p>Now let's run some Windows containers. But first we try if the Linux container is still running and reachable with</p>

<pre><code>start http://localhost  
</code></pre>

<p>With the <code>start</code> command you open Edge with the welcome page of the nginx running in a Linux container</p>

<p><img src="../content/images/2016/09/nginx.png" alt="nginx" /></p>

<p>Yes, the Linux container is still running.</p>

<h2 id="buildawindowswebserver">Build a Windows web server</h2>

<p>On Windows 10 you only can run Nanoserver containers. There is no IIS docker image, so we create our own small Node.js web server. First we write the simple web server app</p>

<pre><code>notepad app.js  
</code></pre>

<p>Enter this code as the mini web server in the file <code>app.js</code> and save the file.</p>

<pre><code class="language-javascript">var http = require('http');  
var port = 81;

function handleRequest(req, res) {  
  res.end('Hello from Windows container, path = ' + req.url);
}

var server = http.createServer(handleRequest);

server.listen(port);  
</code></pre>

<p>Now we build a Windows Docker image with that application. We open another editor to create the <code>Dockerfile</code> with this command</p>

<pre><code>notepad Dockerfile.  
</code></pre>

<p>Enter this as the <code>Dockerfile</code>. As you can see only the <code>FROM</code> line is different from a typical Linux Dockerfile. This one uses a Windows base image from the Docker Hub.</p>

<pre><code class="language-Dockerfile">FROM stefanscherer/node-windows:6.5.0-nano

COPY app.js app.js

CMD [ "node", "app.js" ]  
</code></pre>

<p>Save the file and build the Docker image with the usual command</p>

<pre><code>docker build -t webserver .  
</code></pre>

<p>Run the Windows web server as a Docker container with</p>

<pre><code>docker run -p 81:81 -d webserver  
</code></pre>

<p><img src="../content/images/2016/09/docker-run-webserver-1.png" alt="docker-run-webserver" /></p>

<p>The only thing is you can't connect from your Windows 10 machine to the web server with localhost. Instead you have to contact the web server on port 81 from another machine.</p>

<p><img src="../content/images/2016/09/curl-to-windows-10.png" alt="curl-to-windows-10" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>The new Docker for Windows beta combines the two container worlds and simplifies building Docker images for both Linux and Windows, making a Windows 10 machine a good development platform for both.</p>

<p>And with a little awareness when to switch to the right Docker engine, both Linux and Windows containers can run side-by-side.</p>

<p>Please leave a comment if you have questions or improvements or want to share your thoughts. You can follow me on Twitter <a href="https://twitter.com/stefscherer">@stefscherer</a>.</p>
            <div id="disqus_thread"></div>
            <script>
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//stefanscherersblog.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../author/stefan-scherer/" style="background-image: url(../content/images/2016/03/Stefan-256-1.jpg)"><span class="hidden">Stefan Scherer's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../author/stefan-scherer/">Stefan Scherer</a></h4>

                    <p>Read <a href="../author/stefan-scherer/">more posts</a> by this author.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Germany</span>
                    <span class="author-link icon-link"><a href="https://stefanscherer.github.io">https://stefanscherer.github.io</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=Run%20Linux%20and%20Windows%20Containers%20on%20Windows%2010&amp;url=https://stefanscherer.github.io/run-linux-and-windows-containers-on-windows-10/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://stefanscherer.github.io/run-linux-and-windows-containers-on-windows-10/"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://stefanscherer.github.io/run-linux-and-windows-containers-on-windows-10/"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>
</main>

<aside class="read-next">
    <a class="read-next-story prev no-cover" href="../adding-hyper-v-support-to-2016-tp5-docker-vm/">
        <section class="post">
            <h2>Adding Hyper-V support to 2016 TP5 Docker VM</h2>
            <p>Back in June I have attended the DockerCon in Seattle. Beside lots of new features in Docker 1.12&hellip;</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="https://stefanscherer.github.io">Stefan Scherer&#x27;s Blog</a> &copy; 2016</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
        </footer>

    </div>

    <!-- You can safely delete this line if your theme does not require jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=d314bbb4c7"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=d314bbb4c7"></script>

</body>
</html>
